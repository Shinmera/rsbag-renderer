<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8"/>
    <title>Renderer</title>
    <link rel="stylesheet" type="text/css" href="/static/main.css" />
  </head>
  <body>
    <header>
      <h1>Renderer</h1>
      <nav>
        <a href="select.html" title="Home"><i class="fa fa-home"></i></a>
        <a href="admin.html" title="Administration"><i class="fa fa-wrench"></i></a>
        <a href="/api/shutdown" title="Shut down"><i class="fa fa-power-off"></i></a>
      </nav>
    </header>
    <main class="renderer">
      <div class="error component hidden">
        <header>
          <h2><i class="fa fa-exclamation-triangle"></i> Error</h2>
        </header>
      </div>
      <section class="player bag component" data-frames="10000" data-resolution="200">
        <header>
          <h2>
            <span class="type">file</span>:
            <span class="identifier">hand.tide</span>
          </h2>
          <span class="description">Some description maybe</span>
        </header>
        <nav class="controls">
          <a class="button slower hidden" title="Decrease playback speed"><i class="fa fa-backward fa-fw"></i></a>
          <a class="button pause hidden" title="Pause playback"><i class="fa fa-pause fa-fw"></i></a>
          <a class="button faster hidden" title="Increase playback speed"><i class="fa fa-forward fa-fw"></i></a>
          <a class="button backward" title="Step a single frame backward"><i class="fa fa-step-backward fa-fw"></i></a>
          <a class="button play" title="Start playback"><i class="fa fa-play fa-fw"></i></a>
          <a class="button forward" title="Step a single frame forward"><i class="fa fa-step-forward fa-fw"></i></a>
          <a class="button reset-speed" title="Current playback speed. Double click to reset."><span class="speed">1</span></a>
          <span class="frameinfo">
            <span class="curtime">00:00:000</span>
            <span class="curframe">000000000</span>
          </span>
          <div class="seeker">
            <div class="loaded"></div>
            <div class="current"></div>
          </div>
          <span class="frameinfo">
            <span class="maxtime">00:00:000</span>
            <span class="maxframe">000000000</span>
          </span>
        </nav>
        <section class="visualizations">
        </section>
      </section>
    </main>
    <footer>
      RSBag Visualizer 0.0.1
    </footer>
    <script type="text/javascript" src="/static/jquery-2.1.3.min.js"></script>
    <script type="text/javascript" src="/static/Renderer.js"></script>
    <script type="text/javascript">
      var renderer = null;
      var resourceLoader = null;
      
      $(function(){
          function getUrlParams(url){
              url = url || document.location.href;
              var re = /(?:\?|&(?:amp;)?)([^=&#]+)(?:=?([^&#]*))/g;
              var decode = function(s){return decodeURIComponent(s.replace(/\+/g, " "));};
              var params = {};
              
              while(match = re.exec(url)){
                  var key = decode(match[1]);
                  var val = decode(match[2]);
                  if(typeof params[key] == 'undefined') params[key] = [val];
                  else                                  params[key].push(val)
              }
              return params;
          }
          var params = getUrlParams();
          
          renderer = new Renderer($(".player").first());
          resourceLoader = new ResourceLoader();
          
          function visualizerResource(name, type){
              return {url: "/visualizer/"+name+"."+type, dataType: "text", cache: true};
          }
          
          function sourceResource(name){
              return {url: "/source/"+name+".json", dataType: "json", cache: true};
          }
          
          $.each(params["visualizer"], function(i,visualizer){
              resourceLoader.load([visualizerResource(visualizer,"js"),
                                   visualizerResource(visualizer,"html"),
                                   visualizerResource(visualizer,"css")], renderer.loadVisualizer);
          });
          
          $.each(params["source"], function(i,source){
              resourceLoader.load([sourceResource(source)], renderer.addFrameData);
          });
      });
    </script>
  </body>
</html>
